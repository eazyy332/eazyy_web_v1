import{c as $,u as R,d as L,e as A,r as u,j as e,m as g,X as F,b as H,s as b}from"./index-BsN2_pnW.js";import{n as z}from"./index.browser-OxPLOBIU.js";import{L as O}from"./LazyImage-C9DSb03t.js";import{C}from"./clock-DGqH9gDW.js";import{I as W}from"./info-SxYLStHm.js";import{A as Y}from"./arrow-left-D92mxbb0.js";import{A as M}from"./arrow-right-CJwG2D7Q.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=$("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),ee=()=>{const f=R();L();const{user:a}=A(),y=u.useRef(null),[r,d]=u.useState({images:[],description:"",item_name:"",urgency:"standard"}),[v,N]=u.useState([]),[D,w]=u.useState(!1),[_,p]=u.useState(null),[h,q]=u.useState(!1),k=t=>{if(!t)return;const s=Array.from(t);if(r.images.length+s.length>3){p("Maximum 3 images allowed");return}if(s.filter(i=>{const n=["image/jpeg","image/png","image/webp"].includes(i.type),m=i.size<=10*1024*1024;return!n||!m}).length>0){p("Only JPG, PNG, or WebP images under 10MB are allowed");return}p(null);const l=s.filter(i=>i.type.startsWith("image/")),c=[...r.images,...l];d(i=>({...i,images:c})),l.forEach(i=>{const n=new FileReader;n.onloadend=()=>{N(m=>[...m,n.result])},n.readAsDataURL(i)})},I=t=>{t.preventDefault(),w(!1),k(t.dataTransfer.files)},P=t=>{t.preventDefault(),w(!0)},U=()=>{w(!1)},E=t=>{d(s=>({...s,images:s.images.filter((o,l)=>l!==t)})),N(s=>s.filter((o,l)=>l!==t))},S=async t=>{const s=t.map(async o=>{var x;const l=((x=o.name.split(".").pop())==null?void 0:x.toLowerCase())||"",c=`${crypto.randomUUID()}.${l}`,i=`custom-quotes/${a==null?void 0:a.id}/${c}`,{error:n,data:m}=await b.storage.from("quotes").upload(i,o,{contentType:o.type,cacheControl:"3600"});if(n)throw n;const{data:{publicUrl:j}}=b.storage.from("quotes").getPublicUrl(i);return j});return Promise.all(s)},T=async()=>{if(!a){f("/login",{state:{returnTo:"/order/custom-quote",orderData:r}});return}try{q(!0),p(null);const t=`EZY${z(6).toUpperCase()}`,{data:s,error:o}=await b.from("facilities").select("id").eq("status",!0).limit(1);if(o)throw o;if(!s||s.length===0)throw new Error("No facilities available in the system");const l=s[0].id,c=new Date;c.setDate(c.getDate()+1),c.setHours(9,0,0,0);const{data:i,error:n}=await b.from("orders").insert({order_number:t,user_id:a.id,customer_name:`${(a==null?void 0:a.user_metadata.first_name)||""} ${(a==null?void 0:a.user_metadata.last_name)||""}`.trim(),email:a==null?void 0:a.email,phone:a==null?void 0:a.user_metadata.phone,shipping_address:"To be determined",shipping_method:"standard",pickup_date:c.toISOString(),status:"pending",payment_status:"pending",latitude:"52.3676",longitude:"4.9041",type:"delivery",is_pickup_completed:!1,is_facility_processing:!1,is_dropoff_completed:!1,order_type:"custom_quote",quote_status:"pending",subtotal:0,tax:0,shipping_fee:0,total_amount:0,estimated_pickup_time:"09:00",facility_id:l}).select("id, order_number").single();if(n)throw n;const m=await S(r.images),{data:j,error:x}=await b.from("custom_price_quotes").insert({item_name:r.item_name||r.description.split(`
`)[0],description:r.description,urgency:r.urgency,image_url:m,user_id:a.id,status:"pending",order_id:i.id,order_number:i.order_number,facility_id:l}).select().single();if(x)throw x;f("/order/quote-confirmation",{state:{message:"Your request has been sent! You'll receive a price quote within 2 hours.",requestId:j.id,orderNumber:i.order_number}})}catch(t){console.error("Error submitting quote request:",t),p(t instanceof Error?t.message:"Failed to submit request. Please try again.")}finally{q(!1)}};return e.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Request Custom Price Quote"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Upload photos and provide details about your item for a personalized price quote"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 sm:p-8 mb-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("label",{className:"block text-lg font-medium text-gray-900 mb-4",children:["Upload Images",e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(Up to 3 images)"})]}),e.jsxs("div",{className:`relative border-2 border-dashed rounded-xl p-8 text-center transition-colors duration-300 ${D?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-500"}`,onDrop:I,onDragOver:P,onDragLeave:U,children:[e.jsx("input",{ref:y,type:"file",accept:"image/jpeg,image/png,image/webp",multiple:!0,className:"hidden",onChange:t=>k(t.target.files)}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4",children:[v.map((t,s)=>e.jsxs("div",{className:"relative",children:[e.jsx(O,{src:t,alt:`Preview ${s+1}`,className:"w-full h-32 object-cover rounded-lg",width:"100%",height:"128"}),e.jsx(g.button,{onClick:()=>E(s),className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center",whileHover:{scale:1.1},whileTap:{scale:.9},children:e.jsx(F,{className:"w-4 h-4"})})]},s)),Array.from({length:3-v.length}).map((t,s)=>e.jsx("div",{className:"h-32 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200 flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-gray-400"})},`empty-${s}`))]}),e.jsx("button",{onClick:()=>{var t;return(t=y.current)==null?void 0:t.click()},className:"text-blue-600 font-medium hover:text-blue-700",children:"Upload photos"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"or drag and drop your images here"})]}),_&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:_}),e.jsxs(g.button,{onClick:()=>{var t;return(t=y.current)==null?void 0:t.click()},className:"mt-4 w-full py-3 flex items-center justify-center text-gray-600 hover:text-gray-900",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(H,{className:"w-5 h-5 mr-2"}),"Take a Photo"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Name"}),e.jsx("input",{type:"text",value:r.item_name,onChange:t=>d(s=>({...s,item_name:t.target.value})),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 transition-all duration-300",placeholder:"Enter item name",required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Description"}),e.jsx("textarea",{value:r.description,onChange:t=>d(s=>({...s,description:t.target.value})),placeholder:"Please describe the item and any specific cleaning requirements...",className:"w-full h-32 px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200 transition-all duration-300",required:!0})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("label",{className:"block text-lg font-medium text-gray-900 mb-4",children:"Service Type"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs(g.button,{onClick:()=>d(t=>({...t,urgency:"standard"})),className:`p-4 rounded-xl text-left transition-all duration-300 ${r.urgency==="standard"?"bg-blue-600 text-white":"bg-gray-50 text-gray-900 hover:bg-gray-100"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"Standard Service"})]}),e.jsx("p",{className:r.urgency==="standard"?"text-white/90":"text-gray-600",children:"Regular cleaning with standard turnaround time"})]}),e.jsxs(g.button,{onClick:()=>d(t=>({...t,urgency:"express"})),className:`p-4 rounded-xl text-left transition-all duration-300 ${r.urgency==="express"?"bg-blue-600 text-white":"bg-gray-50 text-gray-900 hover:bg-gray-100"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(C,{className:"w-5 h-5 mr-2"}),e.jsx("span",{className:"font-medium",children:"Express Cleaning"})]}),e.jsx("p",{className:r.urgency==="express"?"text-white/90":"text-gray-600",children:"Priority service with faster turnaround"})]})]})]}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(W,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-900",children:[e.jsx("p",{className:"font-medium mb-1",children:"What happens next?"}),e.jsxs("ul",{className:"space-y-1 text-blue-800",children:[e.jsx("li",{children:"• We'll review your request within 2 hours"}),e.jsx("li",{children:"• You'll receive a detailed price quote via email"}),e.jsx("li",{children:"• Accept the quote to proceed with your order"})]})]})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(g.button,{onClick:()=>f(-1),className:"flex items-center px-6 py-3 text-gray-600 hover:text-gray-900",whileHover:{x:-5},whileTap:{scale:.95},children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsx(g.button,{onClick:T,disabled:!r.description||r.images.length===0||h,className:`flex items-center px-6 py-3 rounded-xl font-medium transition-all duration-300 ${r.description&&r.images.length>0&&!h?"bg-blue-600 text-white shadow-lg hover:shadow-xl":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,whileHover:r.description&&r.images.length>0&&!h?{scale:1.05}:{},whileTap:r.description&&r.images.length>0&&!h?{scale:.95}:{},children:h?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:["Request Quote",e.jsx(M,{className:"w-5 h-5 ml-2"})]})})]})]})]})})};export{ee as default};
