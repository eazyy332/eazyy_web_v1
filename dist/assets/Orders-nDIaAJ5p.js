import{c as S,e as W,u as z,d as B,r as a,s as G,j as e,m as r,A as y,i as J,M as K}from"./index-BsN2_pnW.js";import{A as C}from"./AccountLayout-77iqBrxW.js";import{C as D}from"./check-circle-2-DAVociYa.js";import{F as Q}from"./filter-TYt9X5lP.js";import{S as X}from"./search-DKfhDlon.js";import{P as Y}from"./package-JmuUYXCi.js";import{C as Z}from"./clock-DGqH9gDW.js";import{A as ee}from"./arrow-left-D92mxbb0.js";import{A as se}from"./arrow-right-CJwG2D7Q.js";import{C as te}from"./chevron-up-BEe_jk46.js";import{C as ae}from"./chevron-down-0ENnxVP7.js";import{f as c}from"./format-BuON0pZi.js";import"./log-out-0NWe_3k6.js";import"./file-text-BzJD3yu5.js";import"./settings-DmN2sqhH.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=S("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=S("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),be=()=>{const{user:n}=W(),A=z(),u=B(),[P,T]=a.useState([]),[L,f]=a.useState(!0),[j,v]=a.useState(null),[d,O]=a.useState(""),[l,b]=a.useState({status:"all",dateRange:"all"}),[w,R]=a.useState(!1),[h,F]=a.useState("desc"),[p,E]=a.useState(null),o=a.useRef(!1),[N,_]=a.useState(null);a.useEffect(()=>{var s;if(o.current=!0,n&&k(),(s=u.state)!=null&&s.message){_(u.state.message);const t=setTimeout(()=>{_(null)},5e3);return()=>clearTimeout(t)}return()=>{o.current=!1}},[n,h,u.state]);const k=async()=>{try{v(null),f(!0);const{data:s,error:t}=await G.from("orders").select(`
          *,
          order_items (*)
        `).eq("user_id",n==null?void 0:n.id).order("created_at",{ascending:h==="asc"});if(t)throw t;o.current&&T(s||[])}catch(s){console.error("Error fetching orders:",s),o.current&&v("Failed to load orders. Please try again.")}finally{o.current&&f(!1)}},q=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";case"pending_item_confirmation":return"bg-amber-100 text-amber-800";default:return"bg-gray-100 text-gray-800"}},$=s=>{switch(s){case"pending_item_confirmation":return"Action Required";default:return s.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}},H=s=>{const t=[{label:"Order Placed",completed:!0,date:c(new Date(s.created_at),"MMM d, yyyy - h:mm a")},{label:"Pickup",completed:s.is_pickup_completed||!1,date:c(new Date(s.pickup_date),"MMM d, yyyy - h:mm a")}];return s.type!=="pickup"&&t.push({label:"Processing",completed:s.is_facility_processing||!1,date:s.is_facility_processing?"In Progress":"Pending"},{label:"Delivery",completed:s.is_dropoff_completed||!1,date:s.delivery_date?c(new Date(s.delivery_date),"MMM d, yyyy - h:mm a"):"Pending"}),t},I=s=>{const t=s.order_number.toLowerCase().includes(d.toLowerCase())||s.status.toLowerCase().includes(d.toLowerCase())||s.shipping_address.toLowerCase().includes(d.toLowerCase()),x=l.status==="all"||s.status===l.status;let i=!0;const g=new Date(s.created_at),m=new Date;switch(l.dateRange){case"today":i=g.toDateString()===m.toDateString();break;case"week":const U=new Date(m.setDate(m.getDate()-7));i=g>=U;break;case"month":const V=new Date(m.setMonth(m.getMonth()-1));i=g>=V;break}return t&&x&&i},M=P.filter(I);return j?e.jsx(C,{activeTab:"orders",children:e.jsxs("div",{className:"bg-red-50 rounded-xl p-6 text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:j}),e.jsx(r.button,{onClick:k,className:"px-4 py-2 bg-red-600 text-white rounded-lg",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Try Again"})]})}):e.jsx(C,{activeTab:"orders",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{children:N&&e.jsxs(r.div,{className:"bg-green-50 border border-green-200 rounded-xl p-4 flex items-start",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:[e.jsx(D,{className:"w-5 h-5 text-green-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsx("div",{children:e.jsx("p",{className:"text-green-700",children:N})})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Order History"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(r.button,{onClick:()=>F(s=>s==="asc"?"desc":"asc"),className:"flex items-center px-4 py-2 bg-white rounded-lg shadow text-gray-700 hover:bg-gray-50",whileHover:{scale:1.05},whileTap:{scale:.95},children:[h==="asc"?e.jsx(le,{className:"w-4 h-4 mr-2"}):e.jsx(re,{className:"w-4 h-4 mr-2"}),"Date"]}),e.jsxs(r.button,{onClick:()=>R(!w),className:"flex items-center px-4 py-2 bg-white rounded-lg shadow text-gray-700 hover:bg-gray-50",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Filters"]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(X,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",value:d,onChange:s=>O(s.target.value),placeholder:"Search orders...",className:"w-full pl-12 pr-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200"})]}),e.jsx(y,{children:w&&e.jsxs(r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"bg-gray-50 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:l.status,onChange:s=>b(t=>({...t,status:s.target.value})),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processing",children:"Processing"}),e.jsx("option",{value:"shipped",children:"Shipped"}),e.jsx("option",{value:"delivered",children:"Delivered"}),e.jsx("option",{value:"cancelled",children:"Cancelled"}),e.jsx("option",{value:"pending_item_confirmation",children:"Action Required"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date Range"}),e.jsxs("select",{value:l.dateRange,onChange:s=>b(t=>({...t,dateRange:s.target.value})),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"Last 7 Days"}),e.jsx("option",{value:"month",children:"Last 30 Days"})]})]})]})})]}),L?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading orders..."})]}):M.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Orders Found"}),e.jsx("p",{className:"text-gray-600",children:d||l.status!=="all"||l.dateRange!=="all"?"Try adjusting your filters":"When you place orders, they will appear here"})]}):e.jsx("div",{className:"space-y-4",children:M.map(s=>e.jsx(r.div,{className:"bg-white rounded-xl shadow-lg overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-1",children:["Order #",s.order_number]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:c(new Date(s.created_at),"MMM d, yyyy")})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${q(s.status)}`,children:$(s.status)}),s.status==="pending_item_confirmation"&&e.jsxs(r.button,{onClick:()=>A(`/orders/item-confirmation/${s.id}`),className:"flex items-center px-3 py-1 bg-amber-600 text-white rounded-full text-sm font-medium",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(J,{className:"w-4 h-4 mr-1"}),"Review Items"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:s.type==="pickup"?"Pickup":"Pickup & Delivery"}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(K,{className:"w-5 h-5 text-gray-400 mt-0.5 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-900",children:s.shipping_address}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-blue-600"}),"Pickup: ",c(new Date(s.pickup_date),"MMM d, yyyy - h:mm a")]}),s.type!=="pickup"&&s.delivery_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-600"}),"Delivery: ",c(new Date(s.delivery_date),"MMM d, yyyy - h:mm a")]})]}),s.special_instructions&&e.jsxs("div",{className:"text-sm text-gray-500 mt-2",children:["Note: ",s.special_instructions]})]})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"Items"}),e.jsx("div",{className:"space-y-1",children:s.order_items&&s.order_items.map((t,x)=>{var i;return e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[t.product_name,t.custom_input_value?` (${t.custom_input_value} ${t.unit_label||"units"})`:` × ${t.quantity}`]}),e.jsxs("span",{className:"font-medium text-gray-900",children:["€",((i=t.calculated_price)==null?void 0:i.toFixed(2))||t.subtotal.toFixed(2)]})]},x)})})]})]}),e.jsx(r.button,{onClick:()=>E(p===s.id?null:s.id),className:"mt-4 w-full text-left",children:e.jsxs("div",{className:"flex items-center justify-between text-blue-600 hover:text-blue-700",children:[e.jsx("span",{className:"text-sm font-medium",children:"View Progress"}),p===s.id?e.jsx(te,{className:"w-4 h-4"}):e.jsx(ae,{className:"w-4 h-4"})]})}),e.jsx(y,{children:p===s.id&&e.jsx(r.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 pt-4 border-t border-gray-200",children:e.jsx("div",{className:"space-y-4",children:H(s).map((t,x)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ${t.completed?"bg-green-100 text-green-600":"bg-gray-100 text-gray-400"}`,children:e.jsx(D,{className:"w-4 h-4"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.label}),e.jsx("div",{className:"text-sm text-gray-500",children:t.date})]})]},t.label))})})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Amount"}),e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["€",s.total_amount.toFixed(2)]})]})})]})},s.id))})]})})};export{be as default};
