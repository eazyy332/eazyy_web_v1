import{u as ne,d as ce,e as oe,a as de,f as ue,r as d,j as s,m as c,A as E,S as O}from"./index-BsN2_pnW.js";import{S as M}from"./search-DKfhDlon.js";import{S as xe}from"./star-9nzqfBQH.js";import{T as V}from"./tag-CzsaR-j2.js";import{M as me}from"./minus-Q7ZlvDMF.js";import{P as he}from"./plus-D7P7M6iB.js";import{A as pe}from"./arrow-left-D92mxbb0.js";import{P as k}from"./package-JmuUYXCi.js";import{B as W}from"./brush-C9OZB_SW.js";import{S as Q}from"./scissors-DwO1J0o-.js";import{W as R,S as D}from"./wind-CpSWjsj6.js";const Se=()=>{const _=ne(),U=ce();oe();const{services:u,categories:b,items:T,getServiceCategories:K,getCategoryItems:q,getServiceIdByIdentifier:z}=de(),{addItem:G,isValidUUID:J}=ue(),[o,A]=d.useState("wash-iron"),[h,N]=d.useState(null),[p,X]=d.useState(""),[n,C]=d.useState({});d.useState(!1);const[w,Y]=d.useState({}),[Z,ee]=d.useState(!0);d.useEffect(()=>{u.length>0&&!u.find(e=>e.service_identifier===o)&&A(u[0].service_identifier),u.length>0&&b.length>0&&T.length>0&&ee(!1)},[u,o,b,T]),d.useEffect(()=>{N(null)},[o]);const f=u.find(e=>e.service_identifier===o),$=e=>{switch(e){case"easy-bag":return k;case"wash-iron":return D;case"dry-cleaning":return R;case"repairs":return Q;case"special-care":return W;default:return k}},B=u.map(e=>{var a;const t=Object.values(n).filter(i=>i.serviceId===e.service_identifier&&(!i.custom_input_value||i.confirmed)).reduce((i,l)=>i+l.quantity,0);return{id:e.service_identifier,name:e.name,icon:$(e.service_identifier),color:((a=e.color_scheme)==null?void 0:a.primary)||"bg-blue-600",color_hex:e.color_hex||"#5078bb",itemCount:t,description:e.short_description||""}}),H=K(o),L=h?q(h):H.flatMap(e=>q(e.id)),I=L.filter(e=>{var t;return e.name.toLowerCase().includes(p.toLowerCase())||((t=e.description)==null?void 0:t.toLowerCase().includes(p.toLowerCase()))}),P=Object.values(n).filter(e=>e.serviceId===o&&(!e.custom_input_value||e.confirmed));P.reduce((e,t)=>t.calculated_price?e+t.calculated_price:e+(t.price||0)*t.quantity,0),P.reduce((e,t)=>e+t.quantity,0);const se=Object.values(n).reduce((e,t)=>!t.custom_input_value||t.confirmed?t.calculated_price?e+t.calculated_price:e+(t.price||0)*t.quantity:e,0),v=Object.values(n).reduce((e,t)=>!t.custom_input_value||t.confirmed?e+t.quantity:e,0),S=(e,t)=>{if(e.is_custom_price){_("/order/custom-quote",{state:{item:e,returnPath:U.pathname}});return}C(a=>{var m,y;const i=e.id,l=((m=a[i])==null?void 0:m.quantity)||0,x=Math.max(0,l+t);if(x===0){const{[i]:F,...le}=a;return le}return{...a,[i]:{id:e.id,name:e.name,price:e.price,quantity:x,is_custom_quote:e.is_custom_price,serviceId:o,categoryId:e.category_id,service_name:f==null?void 0:f.name,category_name:(y=b.find(F=>F.id===e.category_id))==null?void 0:y.name}}})},te=(e,t)=>{Y(l=>({...l,[e.id]:t}));const a=parseFloat(t);if(isNaN(a)||e.min_input_value!==null&&a<e.min_input_value||e.max_input_value!==null&&a>e.max_input_value)return;const i=a*(e.unit_price||0);C(l=>{var x;return{...l,[e.id]:{id:e.id,name:e.name,price:e.unit_price||0,quantity:1,custom_input_value:a,calculated_price:i,unit_label:e.unit_label,serviceId:o,categoryId:e.category_id,service_name:f==null?void 0:f.name,category_name:(x=b.find(m=>m.id===e.category_id))==null?void 0:x.name,confirmed:!1}}})},ae=e=>{n[e.id]&&n[e.id].custom_input_value&&C(t=>({...t,[e.id]:{...t[e.id],confirmed:!0}}))},re=()=>{const e=Object.values(n).filter(t=>!t.custom_input_value||t.confirmed);e.length!==0&&(e.forEach(t=>{const a=t.serviceId,i=u.find(l=>l.service_identifier===a);if(i){const l=z(a);if(!l||!J(l)){console.error(`Invalid service identifier: ${a}`);return}console.log("Adding item to cart with service ID:",l),G({id:t.id,name:t.name,price:t.price||0,quantity:t.quantity,custom_input_value:t.custom_input_value,calculated_price:t.calculated_price,unit_label:t.unit_label,serviceId:l,categoryId:t.categoryId,service_name:i.name,category_name:t.category_name},{id:l,name:i.name,icon:$(a).name||"ShoppingBag",color:i.color_hex||"#5078bb"})}}),_("/cart"))},g=e=>({backgroundColor:e}),ie=e=>({backgroundColor:`${e}10`}),j=B.find(e=>e.id===o),r=(j==null?void 0:j.color_hex)||"#5078bb";return Z?s.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:s.jsx("div",{className:"max-w-6xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"})})})}):s.jsx("div",{className:"min-h-screen pt-20 pb-32 px-4 sm:px-6 lg:px-8 bg-gray-50",children:s.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-6xl mx-auto",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Select Service"}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:B.map(e=>s.jsxs(c.button,{onClick:()=>A(e.id),className:`relative flex items-center justify-start p-4 rounded-xl transition-all duration-200 ${e.id===o?"bg-white shadow-md border-2":"bg-white shadow-sm border border-gray-100"}`,style:e.id===o?{borderColor:e.color_hex,borderWidth:"2px"}:{borderColor:"#f3f4f6",borderWidth:"1px"},whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center mr-3 flex-shrink-0",style:{color:e.color_hex},children:s.jsx(e.icon,{className:"w-5 h-5"})}),s.jsx("div",{className:"text-left",children:s.jsx("h3",{className:"font-medium text-gray-900 text-sm",children:e.name})})]},e.id))}),s.jsx(E,{children:j&&s.jsx(c.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-4 p-4 bg-white rounded-xl shadow-sm border border-gray-100",children:s.jsx("p",{className:"text-gray-600 text-sm",children:j.description})})})]}),s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex justify-between items-center mb-3",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Categories"}),s.jsxs("span",{className:"text-sm text-gray-500",children:[L.length," items available"]})]}),s.jsxs("div",{className:"flex space-x-2 overflow-x-auto pb-2 scrollbar-hide",children:[s.jsx(c.button,{onClick:()=>N(null),className:`flex-shrink-0 px-4 py-2 rounded-lg transition-all duration-200 ${h?"bg-white text-gray-700 hover:bg-gray-50 shadow-sm border border-gray-100":"text-white shadow-sm"}`,style:h?void 0:g(r),whileHover:{scale:1.05},whileTap:{scale:.95},children:"All Items"}),H.map(e=>s.jsx(c.button,{onClick:()=>N(e.id),className:`flex-shrink-0 px-4 py-2 rounded-lg transition-all duration-200 ${h===e.id?"text-white shadow-sm":"bg-white text-gray-700 hover:bg-gray-50 shadow-sm border border-gray-100"}`,style:h===e.id?g(r):void 0,whileHover:{scale:1.05},whileTap:{scale:.95},children:e.name},e.id))]})]}),s.jsxs("div",{className:"relative mb-6",children:[s.jsxs("div",{className:"relative",children:[s.jsx(M,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),s.jsx("input",{type:"text",value:p,onChange:e=>X(e.target.value),placeholder:"Search items...",className:"w-full pl-12 pr-4 py-3 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring focus:ring-blue-200 transition-all duration-300 shadow-sm",style:{borderColor:p?r:void 0,boxShadow:p?`0 0 0 1px ${r}20`:void 0}})]}),p&&s.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-sm text-gray-500",children:[I.length," results"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-24",children:s.jsx(E,{mode:"popLayout",children:I.length===0?s.jsxs(c.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"col-span-full text-center py-12 bg-white rounded-xl shadow-sm border border-gray-100",children:[s.jsx(M,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No items found"}),s.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filters"})]}):I.map(e=>{var i,l,x,m;const t=((i=b.find(y=>y.id===e.category_id))==null?void 0:i.name)||"";let a=O;return t.includes("Top")||t.includes("Shirt")?a=D:t.includes("Clean")?a=R:t.includes("Repair")?a=Q:t.includes("Special")?a=W:(t.includes("Mix")||t.includes("Bag"))&&(a=k),s.jsx(c.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:`bg-white rounded-xl p-5 shadow-sm hover:shadow transition-all duration-300 border ${e.is_popular?"border-l-4":"border-gray-100"}`,style:e.is_popular?{borderLeftColor:r}:void 0,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("div",{className:"w-10 h-10 rounded-lg mr-3 flex items-center justify-center",style:{backgroundColor:`${r}15`},children:s.jsx(a,{className:"w-6 h-6",style:{color:r}})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-base font-semibold text-gray-900",children:e.name}),e.is_popular&&s.jsxs("div",{style:ie(r),className:"mt-1 px-2 py-0.5 text-xs font-medium rounded-full inline-flex items-center",children:[s.jsx(xe,{className:"w-3 h-3 mr-1 fill-current",style:{color:r}}),s.jsx("span",{style:{color:r},children:"Popular"})]})]})]}),e.description&&s.jsx("p",{className:"text-gray-600 text-xs mb-2 ml-13",children:e.description}),e.custom_pricing?s.jsxs("div",{className:"space-y-2 mt-2 ml-13",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(V,{className:"w-4 h-4 mr-1",style:{color:r}}),s.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["€",(l=e.unit_price)==null?void 0:l.toFixed(2),"/",e.unit_label]})]}),s.jsxs("div",{className:"flex flex-col space-y-2",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"number",value:w[e.id]||"",onChange:y=>te(e,y.target.value),placeholder:e.input_placeholder||`Enter ${e.unit_label}`,min:e.min_input_value||.1,max:e.max_input_value||100,step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring focus:ring-opacity-50 text-sm",style:{borderColor:w[e.id]?r:void 0,boxShadow:w[e.id]?`0 0 0 1px ${r}40`:void 0}}),s.jsx(c.button,{onClick:()=>ae(e),style:g(r),className:"px-3 py-2 text-white rounded-lg flex-shrink-0 text-sm",whileHover:{scale:1.05},whileTap:{scale:.95},disabled:!w[e.id],children:"Confirm"})]}),n[e.id]&&s.jsxs("div",{className:"text-sm font-medium",style:{color:r},children:["Total: €",((x=n[e.id].calculated_price)==null?void 0:x.toFixed(2))||"0.00",n[e.id].confirmed&&s.jsx("span",{className:"ml-2 text-green-600",children:"✓ Confirmed"})]})]})]}):s.jsxs("div",{className:"flex items-center mt-1 ml-13",children:[s.jsx(V,{className:"w-4 h-4 mr-1",style:{color:r}}),e.price!==null?s.jsxs("span",{className:"text-base font-semibold text-gray-900",children:["€",e.price.toFixed(2)]}):s.jsx("span",{className:"font-medium text-sm",style:{color:r},children:"Custom Price"})]})]}),s.jsx("div",{className:"flex items-center space-x-2 ml-3",children:!e.custom_pricing&&e.price!==null?s.jsxs(s.Fragment,{children:[s.jsx(c.button,{onClick:()=>S(e,-1),className:`w-8 h-8 rounded-full flex items-center justify-center ${n[e.id]?"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,whileHover:n[e.id]?{scale:1.1}:{},whileTap:n[e.id]?{scale:.9}:{},disabled:!n[e.id],children:s.jsx(me,{className:"w-4 h-4"})}),s.jsx("div",{className:"w-6 text-center",children:s.jsx("span",{className:"font-semibold text-gray-900 text-sm",children:((m=n[e.id])==null?void 0:m.quantity)||0})}),s.jsx(c.button,{onClick:()=>S(e,1),style:g(r),className:"w-8 h-8 rounded-full text-white flex items-center justify-center shadow-sm",whileHover:{scale:1.1},whileTap:{scale:.9},children:s.jsx(he,{className:"w-4 h-4"})})]}):e.price===null&&!e.custom_pricing?s.jsx(c.button,{onClick:()=>S(e,1),style:g(r),className:"px-3 py-2 text-white rounded-lg text-xs font-medium shadow-sm",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Request Quote"}):null})]})},`${o}-${e.id}`)})})}),s.jsx(c.div,{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",initial:{y:100},animate:{y:0},transition:{type:"spring",stiffness:300,damping:30},children:s.jsx("div",{className:"max-w-6xl mx-auto",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsxs(c.button,{onClick:()=>_("/"),className:"flex items-center px-4 py-2 text-gray-600 hover:text-gray-900 transition-colors",whileHover:{x:-3},whileTap:{scale:.95},children:[s.jsx(pe,{className:"w-5 h-5 mr-2"}),s.jsx("span",{className:"hidden sm:inline",children:"Back"})]}),s.jsxs("div",{className:"ml-4 sm:ml-8",children:[s.jsx("p",{className:"text-xs text-gray-500",children:"Total Amount"}),s.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["€",se.toFixed(2)]})]})]}),s.jsxs(c.button,{onClick:re,style:g(r),className:"flex items-center justify-center px-6 py-3 rounded-xl font-medium transition-all duration-300 text-white shadow-md",whileHover:v>0?{scale:1.02}:{},whileTap:v>0?{scale:.98}:{},disabled:v===0,children:[s.jsx(O,{className:"w-5 h-5 mr-2"}),"Add to Cart",v>0&&s.jsx("span",{className:"ml-2 bg-white/20 px-2 py-0.5 rounded-full text-sm",children:v})]})]})})})]})})};export{Se as default};
