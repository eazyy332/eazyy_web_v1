import{r as i,u as G,d as J,e as z,s as C,j as t,m as h}from"./index-BsN2_pnW.js";import{I as B}from"./info-SxYLStHm.js";import{S as Q}from"./search-DKfhDlon.js";import{P as U}from"./plus-D7P7M6iB.js";import{A as W}from"./arrow-left-D92mxbb0.js";import{A as X}from"./arrow-right-CJwG2D7Q.js";function M(){return M=Object.assign||function(c){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(c[a]=r[a])}return c},M.apply(this,arguments)}var F=function(c){var o=i.useRef(c);return o.current=c,o},Y=function(c,o){var r;return function(){for(var a=this,x=arguments.length,b=new Array(x),f=0;f<x;f++)b[f]=arguments[f];r!==null&&(clearTimeout(r),r=null),r=setTimeout(function(){return c.apply(a,b)},o)}},Z="ðŸ’¡ use-places-autocomplete: Google Maps Places API library must be loaded. See: https://github.com/wellyshen/use-places-autocomplete#load-the-library",ee=function(o){var r=o===void 0?{}:o,a=r.requestOptions,x=r.debounce,b=x===void 0?200:x,f=r.cache,l=f===void 0?24*60*60:f,y=r.cacheKey,p=y===void 0?"upa":y,O=r.googleMaps,w=r.callbackName,j=r.defaultValue,K=j===void 0?"":j,$=r.initOnMount,k=$===void 0?!0:$,P=i.useState(!1),q=P[0],E=P[1],R=i.useState(K),T=R[0],A=R[1],H=i.useState({loading:!1,status:"",data:[]}),V=H[0],N=H[1],_=i.useRef(),I=F(a),e=F(O),s=i.useCallback(function(){var n;if(!_.current){var u=window,m=u.google,d=e.current,g=(d==null?void 0:d.places)||(m==null||(n=m.maps)==null?void 0:n.places);if(!g){console.error(Z);return}_.current=new g.AutocompleteService,E(!0)}},[e]),v=i.useCallback(function(){N({loading:!1,status:"",data:[]})},[]),S=i.useCallback(function(n){n===void 0&&(n=p);try{sessionStorage.removeItem(n)}catch{}},[p]),D=i.useCallback(Y(function(n){var u;if(!n){v();return}N(function(d){return M({},d,{loading:!0})});var m={};try{m=JSON.parse(sessionStorage.getItem(p)||"{}")}catch{}if(l&&(m=Object.keys(m).reduce(function(d,g){return m[g].maxAge-Date.now()>=0&&(d[g]=m[g]),d},{}),m[n])){N({loading:!1,status:"OK",data:m[n].data});return}(u=_.current)==null||u.getPlacePredictions(M({},I.current,{input:n}),function(d,g){if(N({loading:!1,status:g,data:d||[]}),l&&g==="OK"){m[n]={data:d,maxAge:Date.now()+l*1e3};try{sessionStorage.setItem(p,JSON.stringify(m))}catch{}}})},b),[l,p,v,I]),L=i.useCallback(function(n,u){u===void 0&&(u=!0),A(n),_.current&&u&&D(n)},[D]);return i.useEffect(function(){if(!k)return function(){return null};var n=window,u=n.google;return!e.current&&!(u!=null&&u.maps)&&w?window[w]=s:s(),function(){window[w]&&delete window[w]}},[w,e,s,k]),{ready:q,value:T,suggestions:V,setValue:L,clearSuggestions:v,clearCache:S,init:s}},te="ðŸ’¡ use-places-autocomplete: Please provide an address when using getGeocode() with the componentRestrictions.",se=function(o){var r=new window.google.maps.Geocoder;return new Promise(function(a,x){r.geocode(o,function(b,f){f!=="OK"&&x(f),!o.address&&o.componentRestrictions&&(console.error(te),a(b)),a(b)})})},re=function(o){var r=o.geometry.location,a=r.lat,x=r.lng;return{lat:a(),lng:x()}};const ue=()=>{const c=G(),o=J(),{user:r}=z(),[a,x]=i.useState(null),[b,f]=i.useState(!1),[l,y]=i.useState({name:"",street:"",house_number:"",additional_info:"",city:"",postal_code:""}),[p,O]=i.useState([]),[w,j]=i.useState(null),{ready:K,value:$,suggestions:{status:k,data:P},setValue:q,clearSuggestions:E}=ee({requestOptions:{componentRestrictions:{country:"nl"}},debounce:300}),[R,T]=i.useState(!1);i.useEffect(()=>{if(!r){const e=o.pathname,s=o.state;localStorage.setItem("returnTo",e),s&&localStorage.setItem("orderData",JSON.stringify(s)),c("/login",{state:{returnTo:e,orderData:s}});return}A()},[r,c,o]);const A=async()=>{if(r)try{const{data:e,error:s}=await C.from("user_addresses").select("*").eq("user_id",r.id).order("is_default",{ascending:!1});if(s)throw s;if(e){O(e);const v=e.find(S=>S.is_default);v&&x(v.id)}}catch(e){console.error("Error fetching addresses:",e),j("Failed to load addresses")}},H=async e=>{q(e.description,!1),E(),T(!1);try{const s=await se({placeId:e.place_id}),{lat:v,lng:S}=await re(s[0]),D=s[0].address_components;let L="",n="",u="",m="";for(const d of D){const g=d.types;g.includes("street_number")?n=d.long_name:g.includes("route")?L=d.long_name:g.includes("locality")?u=d.long_name:g.includes("postal_code")&&(m=d.long_name)}y({...l,street:L,house_number:n,city:u,postal_code:m})}catch(s){console.error("Error:",s),j("Failed to get address details")}},V=async e=>{if(e.preventDefault(),!!r)try{const{data:s,error:v}=await C.from("user_addresses").insert([{user_id:r.id,name:l.name,street:l.street,house_number:l.house_number,additional_info:l.additional_info||null,city:l.city,postal_code:l.postal_code,is_default:p.length===0}]).select().single();if(v)throw v;O(S=>[...S,s]),x(s.id),f(!1),E()}catch(s){console.error("Error saving address:",s),j("Failed to save address")}},N=()=>{if(a){const e=p.find(s=>s.id===a);if(e){const s=`${e.street} ${e.house_number}${e.additional_info?`, ${e.additional_info}`:""}`;c("/order/schedule",{state:{...o.state,address:{street:s,city:e.city,postal_code:e.postal_code}}})}}},_=async e=>{if(r)try{await C.from("user_addresses").update({is_default:!1}).eq("user_id",r.id),await C.from("user_addresses").update({is_default:!0}).eq("id",e),await A()}catch(s){console.error("Error setting default address:",s),j("Failed to set default address")}},I=async e=>{if(r)try{await C.from("user_addresses").delete().eq("id",e),await A()}catch(s){console.error("Error deleting address:",s),j("Failed to delete address")}};return t.jsx("div",{className:"min-h-screen pt-safe pb-safe px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:t.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-4xl mx-auto pt-24 pb-12",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-4",children:"Select Delivery Address"}),t.jsx("p",{className:"text-base sm:text-lg text-gray-600",children:"Choose where you'd like your clean laundry delivered"})]}),w&&t.jsxs(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-6 p-4 bg-red-50 rounded-xl text-red-600 text-sm flex items-start",children:[t.jsx(B,{className:"w-5 h-5 mr-2 flex-shrink-0"}),w]}),p.length>0&&!b&&t.jsx("div",{className:"space-y-4 mb-8",children:p.map(e=>t.jsx(h.div,{onClick:()=>x(e.id),className:`w-full p-6 rounded-xl text-left transition-all duration-300 ${a===e.id?"bg-blue-600 text-white shadow-lg":"bg-white hover:bg-gray-50 text-gray-800 shadow hover:shadow-md"}`,whileHover:{scale:1.02},whileTap:{scale:.98},children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center mb-1",children:[t.jsx("h3",{className:"text-lg font-bold",children:e.name}),e.is_default&&t.jsx("span",{className:`ml-2 text-sm ${a===e.id?"text-white/80":"text-blue-600"}`,children:"(Default)"})]}),t.jsxs("p",{className:a===e.id?"text-white/90":"text-gray-600",children:[e.street," ",e.house_number,e.additional_info&&t.jsxs("span",{children:[", ",e.additional_info]}),t.jsx("br",{}),e.postal_code," ",e.city]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(h.button,{onClick:s=>{s.stopPropagation(),_(e.id)},className:`px-3 py-2 rounded-lg text-sm ${a===e.id?"bg-white/20 text-white":"bg-blue-100 text-blue-600"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:"Set Default"}),t.jsx(h.button,{onClick:s=>{s.stopPropagation(),I(e.id)},className:`px-3 py-2 rounded-lg text-sm ${a===e.id?"bg-white/20 text-white":"bg-red-100 text-red-600"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:"Delete"})]})]})},e.id))}),b||p.length===0?t.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-xl shadow-lg p-6 mb-8",children:[t.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-6",children:"Add New Address"}),t.jsxs("form",{onSubmit:V,className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Address Name"}),t.jsx("input",{type:"text",value:l.name,onChange:e=>y({...l,name:e.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"e.g., Home, Office",required:!0})]}),t.jsxs("div",{className:"relative",children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search Address"}),t.jsxs("div",{className:"relative",children:[t.jsx(Q,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),t.jsx("input",{type:"text",value:$,onChange:e=>{q(e.target.value),T(!0)},disabled:!K,className:"w-full pl-12 pr-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"Start typing your address..."})]}),k==="OK"&&R&&t.jsx(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute z-10 w-full mt-1 bg-white rounded-xl shadow-lg border border-gray-200 max-h-60 overflow-auto",children:P.map(e=>t.jsx("div",{className:"px-4 py-3 hover:bg-gray-50 cursor-pointer",onClick:()=>H(e),children:t.jsx("p",{className:"text-gray-900",children:e.description})},e.place_id))})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Street"}),t.jsx("input",{type:"text",value:l.street,onChange:e=>y({...l,street:e.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"Street name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"House Number"}),t.jsx("input",{type:"text",value:l.house_number,onChange:e=>y({...l,house_number:e.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"House number",required:!0})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Info (Optional)"}),t.jsx("input",{type:"text",value:l.additional_info,onChange:e=>y({...l,additional_info:e.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"Apartment number, floor, etc."})]}),t.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),t.jsx("input",{type:"text",value:l.city,onChange:e=>y({...l,city:e.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"City",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Postal Code"}),t.jsx("input",{type:"text",value:l.postal_code,onChange:e=>y({...l,postal_code:e.target.value}),className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:ring focus:ring-blue-200",placeholder:"Postal code",required:!0})]})]}),t.jsxs("div",{className:"flex justify-end space-x-4 pt-4",children:[p.length>0&&t.jsx(h.button,{type:"button",onClick:()=>f(!1),className:"px-6 py-3 text-gray-600 hover:text-gray-900",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Cancel"}),t.jsx(h.button,{type:"submit",className:"px-6 py-3 bg-blue-600 text-white rounded-xl shadow-lg hover:shadow-xl",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Save Address"})]})]})]}):t.jsxs(h.button,{onClick:()=>f(!0),className:"w-full p-6 rounded-xl bg-gray-50 hover:bg-gray-100 text-left transition-all duration-300 flex items-center mb-8",whileHover:{scale:1.02},whileTap:{scale:.98},children:[t.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-100 flex items-center justify-center mr-4",children:t.jsx(U,{className:"text-blue-600"})}),t.jsx("span",{className:"font-medium text-gray-900",children:"Add New Address"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[t.jsxs(h.button,{onClick:()=>c(-1),className:"w-full sm:w-auto flex items-center justify-center px-6 py-3 text-gray-600 hover:text-gray-900",whileHover:{x:-5},whileTap:{scale:.95},children:[t.jsx(W,{className:"w-5 h-5 mr-2"}),"Back"]}),t.jsxs(h.button,{onClick:N,className:`w-full sm:w-auto flex items-center justify-center px-6 py-3 rounded-xl font-medium transition-all duration-300 ${a?"bg-blue-600 text-white shadow-lg hover:shadow-xl":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,whileHover:a?{scale:1.05}:{},whileTap:a?{scale:.95}:{},disabled:!a,children:["Continue",t.jsx(X,{className:"w-5 h-5 ml-2"})]})]})]})})};export{ue as default};
