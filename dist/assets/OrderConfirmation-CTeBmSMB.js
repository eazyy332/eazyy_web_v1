import{u as L,d as G,e as $,r as v,j as e,m as x,M as _,s as w}from"./index-BsN2_pnW.js";import{n as H}from"./index.browser-OxPLOBIU.js";import{A as M}from"./arrow-left-D92mxbb0.js";import{C as p}from"./clock-DGqH9gDW.js";import{A as Q}from"./arrow-right-CJwG2D7Q.js";import{P as k}from"./package-JmuUYXCi.js";import{I as q}from"./info-SxYLStHm.js";import{C as Y}from"./credit-card-DO2M7p6S.js";const D=()=>{const P=L(),C=G(),{user:t}=$(),[n,u]=v.useState(!1),[h,f]=v.useState(null),s=C.state,l=Object.values((s==null?void 0:s.items)||{}).reduce((a,i)=>a+i.price*i.quantity,0),c=l*.21,j=0,m=l+c+j,d=(s==null?void 0:s.type)==="quote",A=async()=>{u(!0),f(null);try{const a=`EZY${H(6).toUpperCase()}`,i=new google.maps.Geocoder,E=s.pickup_address,g=await new Promise((r,I)=>{i.geocode({address:E},(o,R)=>{R==="OK"&&o&&o[0]?r(o[0].geometry.location):I(new Error("Geocoding failed"))})}),S=g.lat().toString(),T=g.lng().toString(),O={order_number:a,user_id:t==null?void 0:t.id,customer_name:`${(t==null?void 0:t.user_metadata.first_name)||""} ${(t==null?void 0:t.user_metadata.last_name)||""}`.trim(),email:t==null?void 0:t.email,phone:t==null?void 0:t.user_metadata.phone,shipping_address:s.pickup_address,shipping_method:s.pickup_option,pickup_date:s.pickup_date,delivery_date:s.delivery_date,special_instructions:s.special_instructions,subtotal:l,tax:c,shipping_fee:j,total_amount:m,status:d?"pending":"awaiting_pickup_customer",payment_status:"pending",latitude:S,longitude:T,type:s.type||"delivery",is_pickup_completed:!1,is_facility_processing:!1,is_dropoff_completed:!1,order_type:d?"custom_quote":"standard",quote_status:d?"pending":"none",estimated_pickup_time:s.estimated_pickup_time,estimated_dropoff_time:s.estimated_dropoff_time},{data:b,error:N}=await w.from("orders").insert(O).select("id, order_number").single();if(N)throw N;const F=Object.values(s.items).map(r=>({order_id:b.id,product_id:r.id,product_name:r.name,quantity:r.quantity,unit_price:r.price,subtotal:r.price*r.quantity})),{error:y}=await w.from("order_items").insert(F);if(y)throw y;P("/checkout/payment",{state:{orderNumber:b.order_number,totalAmount:m}})}catch(a){console.error("Error creating order:",a),f(a instanceof Error?a.message:"Failed to create order"),u(!1)}};return e.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Order Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-blue-800 mb-4 flex items-center",children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),"Pickup Information"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(p,{className:"w-5 h-5 text-blue-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Date & Time"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(s==null?void 0:s.pickup_date).toLocaleString()})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(_,{className:"w-5 h-5 text-blue-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Address"}),e.jsx("p",{className:"text-gray-800 font-medium",children:s==null?void 0:s.pickup_address})]})]})]})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-5",children:[e.jsxs("h3",{className:"text-lg font-semibold text-green-800 mb-4 flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 mr-2"}),"Delivery Information"]}),e.jsxs("div",{className:"space-y-4",children:[s!=null&&s.delivery_date?e.jsxs("div",{className:"flex items-start",children:[e.jsx(p,{className:"w-5 h-5 text-green-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Date & Time"}),e.jsx("p",{className:"text-gray-800 font-medium",children:new Date(s.delivery_date).toLocaleString()})]})]}):e.jsxs("div",{className:"flex items-start",children:[e.jsx(p,{className:"w-5 h-5 text-green-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Date & Time"}),e.jsx("p",{className:"text-gray-500 italic",children:"Same as pickup date"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(_,{className:"w-5 h-5 text-green-600 mt-1 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Address"}),e.jsx("p",{className:"text-gray-800 font-medium",children:(s==null?void 0:s.delivery_address)||(s==null?void 0:s.pickup_address)})]})]})]})]})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-5 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-purple-800 mb-4",children:"Order Summary"}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-5 h-5 text-purple-600 mr-3"}),e.jsx("span",{className:"text-purple-700 font-medium",children:"Total Items"})]}),e.jsxs("span",{className:"font-bold text-gray-900",children:[Object.values((s==null?void 0:s.items)||{}).reduce((a,i)=>a+i.quantity,0)," items"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-5",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Price Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["€",l.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"VAT (21%)"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["€",c.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-600",children:"Shipping"}),e.jsx("span",{className:"font-medium text-green-600",children:"Free"})]}),e.jsx("div",{className:"border-t border-gray-200 pt-3 mt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-lg font-medium text-gray-900",children:"Total Price"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["€",m.toFixed(2)]})]})})]})]})]}),d&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(q,{className:"w-5 h-5 text-amber-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-amber-800 mb-1",children:"Custom Quote Required"}),e.jsx("p",{className:"text-amber-700 text-sm",children:"Your order contains items that require a custom quote. After placing your order, our team will review it and provide a price quote for your approval before processing."})]})]})}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(q,{className:"w-5 h-5 text-red-600 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-red-800 mb-1",children:"Error"}),e.jsx("p",{className:"text-red-700 text-sm",children:h})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[e.jsxs(x.button,{onClick:()=>window.print(),className:"w-full sm:w-auto flex items-center justify-center px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors duration-200",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"Print Receipt"]}),e.jsx(x.button,{onClick:A,disabled:n,className:"w-full sm:w-auto flex items-center justify-center px-6 py-3 bg-blue-600 text-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed",whileHover:{scale:n?1:1.05},whileTap:{scale:n?1:.95},children:n?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-5 h-5 mr-2"}),"Proceed to Payment"]})})]})]})})};export{D as default};
