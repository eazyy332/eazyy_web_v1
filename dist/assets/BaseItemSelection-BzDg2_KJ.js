import{u as K,d as X,e as Y,a as Z,f as ee,r as h,j as s,m as i,A as L,g as se,S as _}from"./index-BsN2_pnW.js";import{I as ae}from"./info-SxYLStHm.js";import{S as q}from"./search-DKfhDlon.js";import{S as te}from"./star-9nzqfBQH.js";import{T as P}from"./tag-CzsaR-j2.js";import{M as le}from"./minus-Q7ZlvDMF.js";import{P as re}from"./plus-D7P7M6iB.js";import{A as ie}from"./arrow-left-D92mxbb0.js";import{S as ne,W as ce}from"./wind-CpSWjsj6.js";import{S as oe}from"./scissors-DwO1J0o-.js";import{B as de}from"./brush-C9OZB_SW.js";import{P as xe}from"./package-JmuUYXCi.js";const Se=({service:f,serviceInfo:c})=>{const j=K(),O=X();Y();const{services:C,categories:u,items:S,getServiceCategories:U,getCategoryItems:I,getServiceIdByIdentifier:E}=Z(),{addItem:M,isValidUUID:b}=ee(),[p,D]=h.useState(""),[r,k]=h.useState({}),[g,T]=h.useState(null),[A,V]=h.useState(!1),[v,Q]=h.useState({}),[R,W]=h.useState(!0),$=U(f);h.useEffect(()=>{C.length>0&&u.length>0&&S.length>0&&W(!1)},[C,u,S]);const w=(g?I(g):$.flatMap(e=>I(e.id))).filter(e=>e.description&&e.description.trim()!==""&&e.facility_added!==!0).filter(e=>e.name.toLowerCase().includes(p.toLowerCase())||e.description&&e.description.toLowerCase().includes(p.toLowerCase())),B=Object.values(r).reduce((e,a)=>a.calculated_price?e+a.calculated_price:e+(a.price||0)*a.quantity,0),F=Object.values(r).reduce((e,a)=>e+a.quantity,0),N=(e,a)=>{if(e.is_custom_price){j("/order/custom-quote",{state:{item:e,returnPath:O.pathname}});return}k(l=>{var d,x;const n=((d=l[e.id])==null?void 0:d.quantity)||0,o=Math.max(0,n+a);if(o===0){const{[e.id]:y,...J}=l;return J}return{...l,[e.id]:{id:e.id,name:e.name,price:e.price,quantity:o,is_custom_quote:e.is_custom_price,serviceId:f,categoryId:e.category_id,service_name:c.name,category_name:(x=u.find(y=>y.id===e.category_id))==null?void 0:x.name}}})},z=(e,a)=>{Q(o=>({...o,[e.id]:a}));const l=parseFloat(a);if(isNaN(l)||e.min_input_value!==null&&l<e.min_input_value||e.max_input_value!==null&&l>e.max_input_value)return;const n=l*(e.unit_price||0);k(o=>{var d;return{...o,[e.id]:{id:e.id,name:e.name,price:e.unit_price||0,quantity:1,custom_input_value:l,calculated_price:n,unit_label:e.unit_label,serviceId:f,categoryId:e.category_id,service_name:c.name,category_name:(d=u.find(x=>x.id===e.category_id))==null?void 0:d.name}}})},G=()=>{if(Object.keys(r).length===0)return;const e=E(f);if(!e||!b(e)){console.error(`Invalid service identifier: ${f}`);return}const a={id:e,name:c.name,icon:c.icon.name||"ShoppingBag",color:c.color_hex||"#5078bb"};console.log("Adding items to cart with service:",e),console.log("Selected items:",r),console.log("Cart data:",a),Object.values(r).forEach(l=>{var o,d;const n=l.categoryId;if(!b(l.id)){console.error(`Invalid item UUID: ${l.id}`);return}if(!b(n)){console.error(`Invalid category UUID: ${n}`);return}console.log("Adding item to cart:",{...l,serviceId:e,categoryId:n,service_name:c.name,category_name:(o=u.find(x=>x.id===n))==null?void 0:o.name}),M({...l,serviceId:e,categoryId:n,service_name:c.name,category_name:(d=u.find(x=>x.id===n))==null?void 0:d.name},a)}),j("/cart")},m=e=>({backgroundColor:e}),H=e=>({backgroundColor:`${e}20`}),t=c.color_hex||"#5078bb";return R?s.jsx("div",{className:"min-h-screen pt-24 pb-12 px-4 sm:px-6 lg:px-8 bg-gradient-to-b from-gray-50 to-white",children:s.jsx("div",{className:"max-w-6xl mx-auto",children:s.jsx("div",{className:"flex items-center justify-center h-64",children:s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent"})})})}):s.jsx("div",{className:"min-h-screen pt-24 pb-32 px-4 sm:px-6 lg:px-8",style:H(t),children:s.jsxs(i.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"max-w-6xl mx-auto",children:[s.jsx(i.div,{className:"bg-white rounded-2xl p-6 mb-8 shadow-lg overflow-hidden relative",whileHover:{scale:1.01},transition:{duration:.2},children:s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{style:m(t),className:"w-16 h-16 rounded-2xl flex items-center justify-center shadow-lg transform transition-transform duration-200 hover:scale-110",children:s.jsx(c.icon,{size:32,className:"text-white"})}),s.jsxs("div",{className:"ml-6",children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:c.name}),s.jsx("p",{className:"text-gray-700 text-lg",children:c.description})]})]}),s.jsx(i.button,{onClick:()=>V(!A),style:m(t),className:"p-3 rounded-xl text-white hover:opacity-90 transition-all duration-200",whileHover:{scale:1.05},whileTap:{scale:.95},children:s.jsx(ae,{className:"w-6 h-6"})})]}),s.jsx(L,{children:A&&s.jsx(i.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-6 pt-6 border-t border-gray-200",children:s.jsxs("div",{children:[s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Service Features"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.features.map((e,a)=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{style:m(t),className:"w-8 h-8 rounded-lg flex items-center justify-center",children:s.jsx(se,{className:"w-5 h-5 text-white"})}),s.jsx("span",{className:"text-gray-700",children:e})]},a))})]})})})]})}),s.jsx("div",{className:"mb-8",children:s.jsxs("div",{className:"flex space-x-4 overflow-x-auto pb-4 scrollbar-hide",children:[s.jsx(i.button,{onClick:()=>T(null),style:g?void 0:m(t),className:`flex-shrink-0 px-6 py-3 rounded-xl transition-all duration-200 ${g?"bg-white text-gray-900 hover:bg-gray-50 shadow":"text-white shadow-lg"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:"All Items"}),$.map(e=>s.jsx(i.button,{onClick:()=>T(e.id),style:g===e.id?m(t):void 0,className:`flex-shrink-0 px-6 py-3 rounded-xl transition-all duration-200 ${g===e.id?"text-white shadow-lg":"bg-white text-gray-900 hover:bg-gray-50 shadow"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:e.name},e.id))]})}),s.jsxs("div",{className:"relative mb-8",children:[s.jsxs("div",{className:"relative",children:[s.jsx(q,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"}),s.jsx("input",{type:"text",value:p,onChange:e=>D(e.target.value),placeholder:"Search items...",className:"w-full pl-12 pr-4 py-4 bg-white rounded-xl border border-gray-200 focus:border-blue-500 focus:ring focus:ring-blue-200 transition-all duration-300 shadow-md",style:{borderColor:p?t:void 0,boxShadow:p?`0 0 0 1px ${t}20`:void 0}})]}),p&&s.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute right-4 top-1/2 transform -translate-y-1/2 text-sm text-gray-500",children:[w.length," results"]})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-24",children:s.jsx(L,{mode:"popLayout",children:w.length===0?s.jsxs(i.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"col-span-full text-center py-12",children:[s.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),s.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No items found"}),s.jsx("p",{className:"text-gray-600",children:"Try adjusting your search or filters"})]}):w.map(e=>{var n,o,d,x;const a=((n=u.find(y=>y.id===e.category_id))==null?void 0:n.name)||"";let l=_;return a.includes("Top")||a.includes("Shirt")?l=ne:a.includes("Clean")?l=ce:a.includes("Repair")?l=oe:a.includes("Special")?l=de:(a.includes("Mix")||a.includes("Bag"))&&(l=xe),s.jsx(i.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:`bg-white rounded-xl p-6 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 ${e.is_popular?"border-l-4":"border border-gray-100"}`,style:e.is_popular?{borderLeftColor:t}:void 0,children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center mb-2",children:[s.jsx("div",{className:"w-12 h-12 rounded-lg mr-3 flex items-center justify-center",style:{backgroundColor:`${t}15`},children:s.jsx(l,{className:"w-7 h-7",style:{color:t}})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),e.is_popular&&s.jsxs("div",{style:H(t),className:"mt-1 px-2 py-0.5 text-xs font-medium rounded-full inline-flex items-center",children:[s.jsx(te,{className:"w-3 h-3 mr-1 fill-current",style:{color:t}}),s.jsx("span",{style:{color:t},children:"Popular"})]})]})]}),s.jsx("p",{className:"text-gray-600 text-sm mb-3 ml-15",children:e.description}),e.custom_pricing?s.jsxs("div",{className:"space-y-3 mt-3 ml-15",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(P,{className:"w-4 h-4 mr-2",style:{color:t}}),s.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["€",(o=e.unit_price)==null?void 0:o.toFixed(2),"/",e.unit_label]})]}),s.jsxs("div",{className:"flex flex-col space-y-2",children:[s.jsx("div",{className:"flex items-center",children:s.jsx("input",{type:"number",value:v[e.id]||"",onChange:y=>z(e,y.target.value),placeholder:e.input_placeholder||`Enter ${e.unit_label}`,min:e.min_input_value||.1,max:e.max_input_value||100,step:"0.1",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring focus:ring-opacity-50",style:{borderColor:v[e.id]?t:void 0,boxShadow:v[e.id]?`0 0 0 1px ${t}40`:void 0}})}),r[e.id]&&s.jsxs("div",{className:"text-sm font-medium",style:{color:t},children:["Total: €",((d=r[e.id].calculated_price)==null?void 0:d.toFixed(2))||"0.00"]})]})]}):s.jsxs("div",{className:"flex items-center ml-15",children:[s.jsx(P,{className:"w-4 h-4 mr-2",style:{color:t}}),e.price!==null?s.jsxs("span",{className:"text-lg font-semibold text-gray-900",children:["€",e.price.toFixed(2)]}):s.jsx("span",{className:"font-medium",style:{color:t},children:"Custom Price"})]})]}),s.jsx("div",{className:"flex items-center space-x-3 ml-4",children:!e.custom_pricing&&e.price!==null?s.jsxs(s.Fragment,{children:[s.jsx(i.button,{onClick:()=>N(e,-1),className:`w-9 h-9 rounded-full flex items-center justify-center ${r[e.id]?"bg-gray-200 text-gray-700 hover:bg-gray-300":"bg-gray-100 text-gray-400 cursor-not-allowed"}`,whileHover:r[e.id]?{scale:1.1}:{},whileTap:r[e.id]?{scale:.9}:{},disabled:!r[e.id],children:s.jsx(le,{className:"w-4 h-4"})}),s.jsx("div",{className:"w-8 text-center",children:s.jsx("span",{className:"font-semibold text-gray-900",children:((x=r[e.id])==null?void 0:x.quantity)||0})}),s.jsx(i.button,{onClick:()=>N(e,1),style:m(t),className:"w-9 h-9 rounded-full text-white flex items-center justify-center shadow-md hover:shadow-lg",whileHover:{scale:1.1},whileTap:{scale:.9},children:s.jsx(re,{className:"w-4 h-4"})})]}):e.price===null&&!e.custom_pricing?s.jsx(i.button,{onClick:()=>N(e,1),style:m(t),className:"px-4 py-2 text-white rounded-xl text-sm font-medium shadow-md hover:shadow-lg",whileHover:{scale:1.05},whileTap:{scale:.95},children:"Request Quote"}):null})]})},e.id)})})}),s.jsx(i.div,{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",initial:{y:100},animate:{y:0},transition:{type:"spring",stiffness:300,damping:30},children:s.jsx("div",{className:"max-w-6xl mx-auto",children:s.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[s.jsxs(i.button,{onClick:()=>j("/order/service"),className:"hidden sm:flex items-center px-6 py-3 text-gray-600 hover:text-gray-900 transition-colors",whileHover:{x:-5},whileTap:{scale:.95},children:[s.jsx(ie,{className:"w-5 h-5 mr-2"}),"Back"]}),s.jsxs("div",{className:"w-full sm:w-auto flex items-center justify-between sm:hidden bg-gray-50 p-3 rounded-xl",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(_,{className:"w-5 h-5 text-gray-600 mr-2"}),s.jsxs("span",{className:"text-gray-600",children:[F," items"]})]}),s.jsxs("span",{className:"font-bold text-gray-900",children:["€",B.toFixed(2)]})]}),s.jsxs("div",{className:"hidden sm:block",children:[s.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount"}),s.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["€",B.toFixed(2)]})]}),s.jsxs(i.button,{onClick:G,style:m(t),className:`w-full sm:w-auto flex items-center justify-center px-8 py-4 rounded-xl font-medium transition-all duration-300 ${Object.keys(r).length>0?"text-white shadow-lg hover:shadow-xl":"bg-gray-200 text-gray-400 cursor-not-allowed"}`,whileHover:Object.keys(r).length>0?{scale:1.05}:{},whileTap:Object.keys(r).length>0?{scale:.95}:{},disabled:Object.keys(r).length===0,children:[s.jsx(_,{className:"w-5 h-5 mr-2"}),s.jsx("span",{children:"Add to Cart"}),s.jsxs("span",{className:"ml-2",children:["(",F,")"]})]})]})})})]})})};export{Se as B};
